---
interface Props {
  title: string;
  activeNav?: string;
  tripPrefix?: string;
  tripTitle?: string;
  tripSubtitle?: string;
  tripFooter?: string;
}

const {
  title,
  activeNav,
  tripPrefix = '/japan2026',
  tripTitle = 'Japan 2026',
  tripSubtitle = 'Tokyo & Kyoto',
  tripFooter = 'japan 2026 · built for travelers',
} = Astro.props;

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const prefix = `${base}${tripPrefix}`;

const navItems = [
  { href: `${prefix}`, label: 'Overview', id: 'home', kanji: '概要' },
  { href: `${prefix}/itinerary`, label: 'Itinerary', id: 'itinerary', kanji: '日程' },
  { href: `${prefix}/restaurants`, label: 'Restaurants', id: 'restaurants', kanji: '食事' },
  { href: `${prefix}/neighborhoods`, label: 'Neighborhoods', id: 'neighborhoods', kanji: '街区' },
  { href: `${prefix}/bookings`, label: 'Bookings', id: 'bookings', kanji: '予約' },
  { href: `${prefix}/hotels`, label: 'Hotels', id: 'hotels', kanji: '宿泊' },
  { href: `${prefix}/budget`, label: 'Budget', id: 'budget', kanji: '予算' },
  { href: `${prefix}/practical-info`, label: 'Practical Info', id: 'practical-info', kanji: '情報' },
];

const currentNav = navItems.find(item => item.id === activeNav);
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title} — {tripTitle}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@300;400;500;700;900&display=swap" rel="stylesheet" />
  </head>
  <body>
    <div class="wrapper">
      <aside>
        <a href={`${base}/`} class="back-link">← All Travels</a>
        <h1 class="sidebar-title">
          <span class="subtitle">{tripSubtitle}</span>
          {tripTitle.split(' ')[0]}<br />{tripTitle.split(' ').slice(1).join(' ')}
        </h1>
        <nav>
          <ul>
            {navItems.map((item) => (
              <li>
                <a href={item.href} class:list={[{ active: activeNav === item.id }]}>
                  {item.label}
                  <div class="nav-curve"></div>
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </aside>

      <main>
        {currentNav && activeNav !== 'home' && (
          <div class="section-header">
            <h2>{currentNav.label}</h2>
            <span class="kanji-stamp">{currentNav.kanji}</span>
          </div>
        )}

        <slot />

        <footer>
          {tripFooter}
        </footer>
      </main>
    </div>
    <!-- Scroll to top button (mobile only) -->
    <button class="scroll-top" aria-label="Scroll to top">↑</button>
  <script>
    // Scroll active nav item into view on mobile (within nav only)
    const active = document.querySelector('nav li a.active');
    if (active && window.innerWidth <= 900) {
      const ul = active.closest('ul');
      if (ul) {
        const offset = active.offsetLeft - (ul.clientWidth / 2) + (active.offsetWidth / 2);
        ul.scrollLeft = Math.max(0, offset);
      }
    }

    // Show/hide scroll-to-top button
    const btn = document.querySelector('.scroll-top');
    if (btn) {
      window.addEventListener('scroll', () => {
        btn.classList.toggle('visible', window.scrollY > 400);
      }, { passive: true });
      btn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }
  </script>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>
